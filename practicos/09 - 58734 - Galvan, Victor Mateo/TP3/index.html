<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Control Depósito</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        #root {
            width: 100%;
            max-width: 600px;
            margin: 20px;
        }

        .titulo-inventario {
            font-size: 24px;
            margin-bottom: 20px;
            color: #000;
            text-align: center;
        }

        .agregar-botones {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .agregar-botones button {
            background-color: #28a745;
            border: none;
            color: white;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
        }

        .agregar-botones button:hover {
            background-color: #218838;
        }

        .panel {
            width: calc(100% - 20px);
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            position: relative;
            transition: box-shadow 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .acciones {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .acciones button {
            background-color: transparent;
            border: none;
            cursor: pointer;
        }

        .acciones button:hover {
            color: #007bff;
        }

        .acciones button svg {
            width: 20px;
            height: 20px;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        function generarCodigoBarras() {
            return Math.floor(100000000000 + Math.random() * 900000000000).toString();
        }

        function Editar({ producto, alGuardar }) {
            const [nombre, setNombre] = useState(producto.nombre);
            const [codigoBarras, setCodigoBarras] = useState(producto.codigoBarras);
            const [cantidad, setCantidad] = useState(producto.cantidad);

            const handleChange = (setter) => (e) => setter(e.target.value);
            const handleCantidadChange = (e) => {
                let value = parseInt(e.target.value, 10);
                setCantidad(value > 100 ? 100 : value);
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                alGuardar({ ...producto, nombre, codigoBarras, cantidad });
            };

            return (
                <form className="panel" onSubmit={handleSubmit}>
                    <label>Nombre:</label>
                    <input type="text" value={nombre} onChange={handleChange(setNombre)} />

                    <label>Código de Barras:</label>
                    <input type="text" value={codigoBarras} onChange={handleChange(setCodigoBarras)} />

                    <label>Cantidad:</label>
                    <input type="number" value={cantidad} onChange={handleCantidadChange} />

                    <div className="acciones">
                        <button type="submit">Aceptar</button>
                        <button type="button" onClick={() => alGuardar(null)}>Cancelar</button>
                    </div>
                </form>
            );
        }

        function Mostrar({ producto, alEditar, alBorrar }) {
            const [editando, setEditando] = useState(false);

            const handleGuardar = (nuevoProducto) => {
                setEditando(false);
                if (nuevoProducto) {
                    alEditar(nuevoProducto);
                }
            };

            const incrementarCantidad = () => {
                if (producto.cantidad < 100) {
                    alEditar({ ...producto, cantidad: producto.cantidad + 1 });
                }
            };

            return editando ? (
                <Editar producto={producto} alGuardar={handleGuardar} />
            ) : (
                <div className="panel" onClick={incrementarCantidad}>
                    <h2 style={{ fontSize: '30px', color: 'blue', margin: '0' }}>{producto.cantidad}</h2>
                    <div>
                        <h3 style={{ margin: '0' }}>{producto.nombre}</h3>
                        <p style={{ margin: '0' }}>{producto.codigoBarras}</p>
                    </div>
                    <div className="acciones">
                        <button onClick={(e) => { e.stopPropagation(); setEditando(true); }}>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M12 4.5c-4.142 0-7.5 3.358-7.5 7.5s3.358 7.5 7.5 7.5 7.5-3.358 7.5-7.5-3.358-7.5-7.5-7.5zm-1 11h-1v-1h1v1zm0-2h-1v-4h1v4z"/>
                            </svg>
                        </button>
                        <button onClick={(e) => { e.stopPropagation(); alBorrar(producto.id); }}>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M3 6h18v2h-18v-2zm2 4h14l-1 12h-12l-1-12zm5-6h4v2h-4v-2z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            );
        }

        function Inventario({ datos, alAgregar, alEditar, alBorrar }) {
            return (
                <div className="inventario">
                    <h1 className="titulo-inventario">Control Depósito</h1>
                    <div className="agregar-botones">
                        <button onClick={alAgregar}>Agregar</button>
                    </div>
                    {datos.sort((a, b) => b.cantidad - a.cantidad).map((producto) =>
                        <Mostrar
                            key={producto.id}
                            producto={producto}
                            alEditar={alEditar}
                            alBorrar={alBorrar}
                        />
                    )}
                </div>
            );
        }

        function proximoId(productos) {
            return Math.max(0, ...productos.map(p => p.id)) + 1;
        }

        function leerProductos() {
            return JSON.parse(localStorage.getItem('productos')) || [];
        }

        function guardarProductos(productos) {
            localStorage.setItem('productos', JSON.stringify(productos));
        }

        function App() {
            const productosIniciales = [
                { id: 1, nombre: "7up", codigoBarras: "7799876543210", cantidad: 7 },
                { id: 2, nombre: "Cola Cola", codigoBarras: "7791234567890", cantidad: 92 },
                { id: 3, nombre: "Fanta", codigoBarras: "7793219876540", cantidad: 5 },
                { id: 4, nombre: "Mirinda", codigoBarras: "7797894561230", cantidad: 6 },
                { id: 5, nombre: "Sprite", codigoBarras: "7796543219870", cantidad: 4 }
            ];
            const [productos, setProductos] = useState(productosIniciales);

            useEffect(() => {
                const datos = leerProductos();
                if (datos.length > 0) {
                    setProductos(datos);
                } else {
                    guardarProductos(productosIniciales);
                }
            }, []);

            useEffect(() => {
                guardarProductos(productos);
            }, [productos]);

            const agregar = () => {
                const nuevoProducto = { id: proximoId(productos), nombre: "", codigoBarras: generarCodigoBarras(), cantidad: 1 };
                setProductos([...productos, nuevoProducto]);
            };

            const editar = (productoActualizado) => {
                const copia = productos.map(p => p.id === productoActualizado.id ? productoActualizado : p);
                setProductos(copia);
            };

            const borrar = (id) => {
                const copia = productos.filter(p => p.id !== id);
                setProductos(copia);
            };

            return (
                <Inventario
                    datos={productos}
                    alAgregar={agregar}
                    alEditar={editar}
                    alBorrar={borrar}
                />
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
